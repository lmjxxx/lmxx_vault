# MITM (Meet in the Middle)

## 공격 조건
1. 이중 암호화(Double Encryption)또는 다단계 암호화 사용 시:
	- Double DES, Double AES 등.
2. 독립된 키 사용
	- 서로 다른 두 개의 키 ($K_1, K_2$)가 사용되는 경우
3. 중간 단계 값이 유추 가능
	- 암호화와 복호화 과정의 중간 값을 기반으로 테이블을 구성할 수 있는 경우

## 공격 설명

Double DES 는 두 개의 서로 다른 키 K1, K2 를 사용해 데이터를 두 번 암호화 한다.

$C=E_{K2}​(E_{K1}​(P))$

P : 평문 (Plaintext)
E : DES 암호화 함수
C : 암호문 (Ciphertext)

MITM 공격의 핵심은 중간 단계를 찾는 것
암호화 과정에서 다음과 같이 나누어 생각

1. $X = E_{k1}(P)$
2. $C = E_{k2}(X)$

## 공격 과정
1. 1차 암호화 결과를 기반으로 테이블 생성
	- 모든 가능한 K_1 에 대해 
$$X = E_{k1}(P)$$
	- X 값을 해시 테이블에 저장 (Key: X, Value: K1)
2. 2차 복호화와 테이블 비교
	- 모든 가능한 K_2 에 대해:
$$X' = D_{k2}(C)$$
	- 해시 테이블에서 X' 와 일치하는 값이 있는지 검색
3. 일치하는 경우
	- 발견된 K1, K2 는 진자 키 쌍일 가능성이 높음

| 공격 방식       | 키 공간 (시도 횟수) | 메모리 요구량 |
| ----------- | ------------ | ------- |
| Brute Force | 2^112        | 무시 가능   |
| MITM        | 2^56 + 2^56  | 2^56    |

## 방어 방법 
1. Triple DES (3DES) : 3 개의 키를 사용하여 암호화 수행
2. AES 사용 : AES-128, AES-256 과 같이 더 강력한 알고리즘으로 전환
3. 무작위 패딩 : 중간값 예측을 어렵게 만들기

- One-Time Pad : 무작위 키 사용
- True End-to-End 암호화 : 세션 키가 매번 무작위로 생성될 때
- 공격 표면 축서 : AES-256, ChaCha20 등 단일 키 기반 현대 알고리즘